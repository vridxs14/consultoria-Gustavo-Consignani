<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra | Gustavo Consignani</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/components.css">

    <style>
        .checkout-section { padding: 120px 20px; text-align: center; max-width: 600px; margin: 0 auto; }
        .checkout-card { 
            background: var(--bg-card); 
            padding: 40px; 
            border-radius: 10px; 
            border: 1px solid rgba(89, 60, 204, 0.3); /* Borda Roxa Sutil */
            box-shadow: 0 0 30px rgba(89, 60, 204, 0.1);
        }
        .plan-summary { 
            margin: 30px 0; 
            padding: 20px; 
            background: #050505; 
            border-radius: 5px; 
            border-left: 4px solid var(--primary-color); 
            text-align: left; 
        }
        .price-tag { font-size: 1.5rem; color: var(--primary-color); font-weight: bold; float: right; }
        #loading-msg { font-size: 1.2rem; color: #888; }
        .hidden { display: none; }
        
        .user-info { margin-bottom: 30px; text-align: left; border-bottom: 1px solid #222; padding-bottom: 15px; }
        .user-info p { color: #ccc; margin-bottom: 5px; }
        .user-info strong { color: white; }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">Gustavo<span>Consignani</span></a>
        </div>
    </header>

    <section class="checkout-section">
        <div id="loading-check">
            <p id="loading-msg">Carregando pedido...</p>
        </div>

        <div id="checkout-content" class="checkout-card hidden">
            <h1>Resumo do Pedido</h1>
            <p style="color: #ccc;">Voc√™ est√° a um passo de transformar seu corpo.</p>

            <div class="plan-summary">
                <span id="plan-name" style="font-weight: 700; color: white;">Plano Selecionado</span>
                <span id="plan-price" class="price-tag">R$ 0,00</span>
                <div style="clear: both; padding-top: 10px; font-size: 0.9rem; color: #888;" id="plan-desc">Detalhes...</div>
            </div>

            <div class="user-info">
                <p><strong>Aluno:</strong> <span id="user-email">...</span></p>
                <p style="font-size: 0.8rem; color: #666;">Conta vinculada para acesso ao App</p>
            </div>

            <a id="btn-pay" href="#" class="btn btn-primary" style="width: 100%; display: block;">
                FINALIZAR INSCRI√á√ÉO
            </a>
            
            <p style="margin-top: 15px; font-size: 0.8rem; color: #666;">
                üîí Ambiente de teste (Simula√ß√£o de Pagamento)
            </p>
        </div>
    </section>

    <script type="module">
        import { auth } from './assets/js/firebase-config.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const urlParams = new URLSearchParams(window.location.search);
        const selectedPlan = urlParams.get('plano'); 

        // ============================================================
        // CONFIGURA√á√ÉO DE TESTE (O PULO DO GATO) üêà
        // Todos os links apontam para 'anamnese.html' para simular sucesso
        // ============================================================
        const plansData = {
            'mensal': { 
                name: 'Consultoria Mensal', 
                price: 'R$ 129,97', 
                link: 'anamnese.html', 
                desc: 'Renova√ß√£o mensal sem fidelidade.' 
            },
            'trimestral': { 
                name: 'Consultoria Trimestral', 
                price: 'R$ 299,70', 
                link: 'anamnese.html', 
                desc: 'Plano de 3 meses (Equivalente a R$ 99,90/m√™s).' 
            },
            'semestral': { 
                name: 'Consultoria Semestral', 
                price: 'R$ 539,40', 
                link: 'anamnese.html', 
                desc: 'Plano de 6 meses (Melhor valor).' 
            }
        };

        const loadingDiv = document.getElementById('loading-check');
        const contentDiv = document.getElementById('checkout-content');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // 1. Logado: Carrega os dados
                if (!selectedPlan || !plansData[selectedPlan]) {
                    alert("Plano n√£o selecionado.");
                    window.location.href = 'planos.html';
                    return;
                }

                document.getElementById('plan-name').textContent = plansData[selectedPlan].name;
                document.getElementById('plan-price').textContent = plansData[selectedPlan].price;
                document.getElementById('plan-desc').textContent = plansData[selectedPlan].desc;
                document.getElementById('user-email').textContent = user.email;
                
                // APLICA O LINK DE "PULO"
                document.getElementById('btn-pay').href = plansData[selectedPlan].link;

                loadingDiv.style.display = 'none';
                contentDiv.classList.remove('hidden');

            } else {
                // 2. N√£o Logado: Manda pro Login e volta pra c√° depois
                window.location.href = `login.html?redirect=checkout&plano=${selectedPlan}`;
            }
        });
    </script>
</body>
</html>
